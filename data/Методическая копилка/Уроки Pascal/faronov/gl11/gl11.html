<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>
</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body BGCOLOR="#E7E3E7" TEXT="#000000" LINK="#004080" VLINK="#004080">

<table COLS="3" width="%">
<tr>
<td width="%">
<font face="Arial, Helvetica, sans-serif">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0"  >
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Arial, Helvetica, sans-serif">
<a href="gl11_1.html">
<img SRC="For.gif" BORDER="0"  >
</a>
</font>
</td>
</tr>
</table>
<p>
&nbsp;
</p>
<p align="center">
<font face="Arial, Helvetica, sans-serif" size="3">
<b>
<font size="4">
 
Другие возхможности Турбо Паскаля

</font>
</b>
<br>
</font>
</p>


<p align="left">
<font face="Arial, Helvetica, sans-serif" size="3"></font>
<ul>

    <li><font face="Arial, Helvetica, sans-serif" size="3">Внешние
      процедуры(функции)</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Использование встроенных машинных
      кодов</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Обращение к функциям операционной
      системы</font></li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Поддержка процедур обработки
      прерываний</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Запуск
      внешних программ</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Оверлей</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Прямое обращение
      к памяти и портам ввода-вывода</font>
    </li>
    <li><font face="Arial, Helvetica, sans-serif" size="3">Длинные строки</font></li>
  </ul>
<p>&nbsp;</p>

<p align="center">
<font face="Arial, Helvetica, sans-serif" size="3">
<b>
<font size="4">
 
Внешние процедуры (функции)

</font>
</b>
<br>
</font>
</p>


<P><font face="Arial, Helvetica, sans-serif" size="3">С помощью внешних процедур (функций) можно осуществить вызов из программы 
процедур или функций, написанных на языке ассемблера. Ассемблер обеспечивает 
компиляцию программ, написанных на машинно-ориентированном языке 
программирования низкого уровня. В Турбо Паскале есть собственный встроенный 
ассемблер см. гл.12). В этом разделе речь идет о программах, написанных и 
откомпилированных с помощью внешнего ассемблера, такого как, например, ассемблер 
фирмы MicroSoft или Turbo Assembler фирмы Borland.</font> </P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Машинно-ориентированный язык ассемблера предоставляет квалифицированному 
программисту богатейшие возможности использования всех особенностей архитектуры 
ПК. Ассемблерные программы выполняются значительно быстрее и занимают меньший 
объем памяти, чем программы, написанные на Турбо Паскале, однако низкий уровень 
языка ассемблера существенно снижает производительность труда программиста и 
резко усложняет отладку программ. Как правило, на языке ассемблера пишутся 
сравнительно небольшие фрагменты программ, в которых используются недоступные из 
Турбо Паскаля особенности архитектуры ПК.</font> </P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Внешняя процедура (функция) в программе, написанной на Турбо Паскале, 
объявляется своим заголовком, за которым следует стандартная директива EXTERNAL, 
например:</font> </P>
<P><font face="Verdana, Arial, Helvetica, sans-serif" size="3">Function LoCase (ch : char):char; external;&nbsp;</font> </P>
<P><font face="Verdana, Arial, Helvetica, sans-serif" size="3"> Procedure Swapping (var a,b; N:word);
external;</font> </P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Как видно из этих примеров, тело внешней процедуры (функции) отсутствует - 
его заменяет директива EXTERNAL. Для подключения ассемблерной программы необходимо предварительно ее откомпилировать и получить объектный файл с 
расширением OBJ, содержащий перемещаемый код ассемблерной программы. 
Непосредственно перед описанием внешней процедуры (функции) в тело основной программы 
вставляется директива компилятора {$L&lt;имя файла&gt;}, где &lt;имя фата&gt; - имя 
OBJ-файла. Диск и каталог, в котором следует искать этот файл, если он не 
обнаружен в текущем каталоге, указываются опцией OPTIONS/DIRECTORIES/OBJECT DIRECTORIES (см.прил.1).</font> 
</P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Перед передачей управления внешней процедуре (функции) программа помещает 
параметры обращения в программный стек в том порядке, как они перечислены в 
заголовке процедуры (функции). Ассемблерная процедура должна сохранить регистры 
ВР, SP, SS и DS центрального процессора в самом начале своей работы и 
восстановить содержимое этих регистров перед возвратом управления в программу. 
Остальные регистры можно не сохранять и соответственно не восстанавливать.</font> </P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Параметры могут передаваться по ссылке или по значению. Если параметр 
передается по ссылке, в стек помещается указатель, содержащий абсолютный адрес
параметра, если по значению - в стек помещается сам параметр, точнее - его значение. 
Все параметры-переменные, т.е. параметры, объявленные в заголовке с 
предшествующим словом VAR, всегда передаются по ссылке. Параметры-значения могут 
передаваться по ссылке или по значению в зависимости от длины внутреннего 
представления соответствующего параметра. В общем случае используется следующее 
правило: если длина внутреннего представления параметра-значения составляет 1, 2 
или 4 байта, он передается своим значением, т.е. его значение помещается в стек. 
Точно так же через стек передаются и все вещественные данные длиной в 4, 6, 8 и 
10 байт (в версии 4.0 эти данные передаются через стек сопроцессора 8087/80287, 
начиная с версии 5.0 -через стек центрального процессора 8086/80486). Во всех 
остальных случаях, если длина внутреннего представления больше 4 байт, 
соответствующий параметр передается по ссылке.</font> </P>
<P><font face="Arial, Helvetica, sans-serif" size="3">Ассемблерные функции в зависимости от длины внутреннего представления 
результата должны возвращать его через регистры центрального процессора или 
сопроцессора по следующим правилам:</font> </P>
<ul>
  <li><font face="Arial, Helvetica, sans-serif" size="3">длиной в 1 байт - в регистре AL;</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">длиной в 2 байта - в регистре АХ;</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">длиной в 4 байта - в регистрах DX:AX (старшее слово в DX);</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">тип REAL (6 байт) - в регистрах DX:BX:AX;</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">типы SINGLE, DOUBLE, EXTENDED и СОМР - через стек сопроцессора 8087/80486;</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">указатели - в регистрах DX:AX (сегмент в DX);</font></li>
  <li><font face="Arial, Helvetica, sans-serif" size="3">строки возвращаются по ссылке: адрес начала строки помещается в DX:AX 
(сегмент в DX).</font></li>
</ul>
<P><font face="Arial, Helvetica, sans-serif" size="3">Все ассемблерные процедуры должны размещаться в сегменте с именем CODE или 
CSEG, или с именем, оканчивающимся на _ТЕХТ; инициализированные локальные 
Переменные помещаются в сегмент с именем CONST или с именем, оканчивающимся на 
_DATA. Все другие локальные переменные необходимо размещать в сегменте с именем 
DATA или DSEG, или с именем, оканчивающимся на _BSS. Любые другие объявления 
сегментов игнорируются. Все имена, объявленные в интерфейсной части модулей 
программы, написанной на Турбо Паскале, становятся доступны ассемблерной 
процедуре (функции) после их объявления директивой EXTRN. Точно так же все имена 
ассемблерных процедур и функций, которые должны быть доступны программе на Турбо 
Паскале, следует объявлять директивой PUBLIC.</font> </P>

<p>&nbsp;</p>

<table COLS="3" width="%">
<tr>
<td width="%">
<font face="Arial, Helvetica, sans-serif">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0"  >
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Arial, Helvetica, sans-serif">
<a href="gl11_1.html">
<img SRC="For.gif" BORDER="0"  >
</a>
</font>
</td>
</tr>
</table>

</BODY></HTML>